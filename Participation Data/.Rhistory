Event.raw = Event,
Event = case_when(
Event.raw == "100y" ~ "100m",
Event.raw == "880y" ~ "800m",
Event.raw == "1500m" ~ "1600m",
Event.raw == "Mile" ~ "1600m",
TRUE ~ Event.raw
))
performance_one <- performance |>
group_by(State, Year, Gender, Event) |>
summarize(Mark = min(Mark)) |>
ungroup() #|>
#pivot_wider( names_from=c(Gender), values_from=Mark)
write.csv(performance, "performance_clean.csv", row.names = F)
write.csv(performance_one, "performance_one_clean.csv", row.names = F)
performance |>
count(State)
performance |>
filter(State=="Massachusetts",
Year < 1982,
Event == "100y / 100m") |>
summarize(mean = mean(Mark))
performance_one |>
ungroup() |>
count(State, Event, Gender) |>
print(n=500)
library(tidyverse)
library(huxtable)
library(plm)
setwd("C:\\Users\\reb\\OneDrive\ -\ Colostate\\Thesis\\Participation\ Data\\")
participation <- read.csv("participation_clean.csv")
nces <- read.csv("nces_clean.csv")
census <- read.csv("census_2020_clean.csv")
setwd("..\\Historical\ Performance\ Data\\")
performance <- read.csv("performance_clean.csv") |>
select(Year, State, Gender, Event, Mark, Mark.Note)
performance_one <- read.csv("performance_one_clean.csv")
data.all <- participation |>
right_join(performance, by=c("State","Year","Gender")) %>%
left_join(nces, by=c("State", "Year")) %>%
left_join(census, by=c("State", "Gender"), relationship = "many-to-many")
data <- participation |>
right_join(performance_one, by=c("State","Year","Gender")) |>
left_join(nces, by=c("State", "Year")) %>%
left_join(census, by=c("State", "Gender"), relationship = "many-to-many") %>%
pivot_wider(names_from = Gender, names_sep=".", values_from = c(Schools, Participation, Mark, Count))
m1 <- data %>%
filter(Event=="100m") %>%
plm(Mark.Girls ~ Participation.Girls, data=., model="within")
huxreg(m1)
m1 <- data %>%
filter(Event=="High Jump") %>%
plm(Mark.Boys ~ Participation.Boys, data=., model="random")
huxreg(m1)
data.analysis <- data %>%
mutate(Participation.Pct.Diff = (Participation.Boys - Participation.Girls)/Participation.Boys *100,
Mark.Pct.Diff = (Mark.Boys - Mark.Girls)/Mark.Boys *100,
Prop.Boys = Count.Boys/(Count.Boys+Count.Girls),
Prop.Girls = Count.Girls/(Count.Boys+Count.Girls))
m1 <- data.analysis %>%
filter(Event=="100m") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m2 <- data.analysis %>%
filter(Event=="800m") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m3<-data.analysis %>%
filter(Event=="1600m") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m4<-data.analysis %>%
filter(Event=="High Jump") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m5<-data.analysis %>%
filter(Event=="Pole Vault") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
huxreg(m1,m2,m3,m4,m5)
data |>
select(Year,State,Event) |>
distinct() |>
count(State,Event) %>%
print(n=100)
View(data.analysis)
library(tidyverse)
library(rvest)
library(tabulapdf)
setwd("C:\\Users\\reb\\OneDrive\ -\ Colostate\\Thesis\\Historical\ Performance\ Data\\Oregon")
"https://www.osaa.org/docs/btf/records/20196a5aChampionsOnly.htm"
names <- '<select name="records" class="yearbyyearlist" data-root="https://www.osaa.org/docs/btf/records">
<option value="">Select Year</option>
<option value="20196a5aChampionsOnly.htm">2019 6A-5A</option>
<option value="20194a3aChampionsOnly.htm">2019 4A-3A</option>
<option value="20192a1aChampionsOnly.htm">2019 2A-1A</option>
<option value="2018ChampionsOnly.htm">2018</option>
<option value="2017ChampionsOnly.htm">2017</option>
<option value="2016ChampionsOnly.htm">2016</option>
<option value="2015ChampionsOnly.htm">2015</option>
<option value="2014ChampionsOnly.htm">2014</option>
<option value="20136a5a4aChampionsOnly.htm">2013 6A-5A-4A</option>
<option value="20133a2a1aChampionsOnly.htm">2013 3A-2A-1A</option>
<option value="20126a5a4aChampionsOnly.htm">2012 6A-5A-4A</option>
<option value="20123a2a1aChampionsOnly.htm">2012 3A-2A-1A</option>
</select>' |>
str_extract_all("20[0-9][0-9][1-6a]*ChampionsOnly.htm")
names <- str_split(names[[1]], " ")
names_pdf <- list("boysTrackChampionsThrough2011",
"girlsTrackChampionsThrough2011",
"btrackchampsthrough06",
"gtrackchampsthrough06")
html <- lapply(names, function(l){
read_html(paste("https://www.osaa.org/docs/btf/records/", l, sep=""))
})
l <- html[[6]]
dfs <- list()
cleandata1 <- lapply(html, function(l){
dfs[[length(dfs)+1]]<- data.frame(txt = html_text(l)) |>
separate_rows(txt, sep="\n") |>
mutate(header = str_extract(txt, "(Girls|Boys) [A-Za-z0-9 ]+ [0-9]A"),
Year = str_extract(txt, "[12][0-9][0-9][0-9] OSAA"),
Year = str_extract(Year, "[12][0-9][0-9][0-9]")) |>
fill(header, Year) |>
separate_wider_regex(header, c(" *",
Gender = "(?:Girls|Boys)",
" *",
Event = "[A-Za-z0-9 ]+",
" *",
Class = "[0-9]A",
" *")) |>
filter(str_detect(txt, "1 [^0-9]+ +[0-9]* [^0-9]") ,
!str_detect(txt, "[0-9]\\) [^0-9]")) |>
separate_wider_regex(txt, c(" *",
Rank = "1",
" *",
Name = "[^0-9]+",
" *",
Grade = "[0-9]*",
" *",
School = "[^0-9]+",
" *",
Prelim = "(?:[0-9]+[\\.\\-:]+[0-9\\.\\-:]+)?",
" +",
Mark = "[0-9]+[\\.\\-:]+[0-9][0-9\\.\\-:]+",
" *",
Mark.Note = "(?:[\\+\\-]?[0-9]\\.[0-9])?",
".*"), too_few="debug")
})  |>
bind_rows()  |>
mutate(Event = trimws(str_replace(Event, " Meter (Run|Dash)", "m")),
State = "Oregon",
Year = as.numeric(Year)) |>
filter(Event %in% c("100m", "800m", "1500m", "High Jump", "Pole Vault"))|>
select(State, Year, Gender, Event, Class, Mark, Mark.Note)
#c<- dfs[[1]]
cleandata |>
filter(Year == 2016, Event == "High Jump", Gender=="Boys")
library(tidyverse)
library(rvest)
library(tabulapdf)
setwd("C:\\Users\\reb\\OneDrive\ -\ Colostate\\Thesis\\Historical\ Performance\ Data\\Oregon")
"https://www.osaa.org/docs/btf/records/20196a5aChampionsOnly.htm"
names <- '<select name="records" class="yearbyyearlist" data-root="https://www.osaa.org/docs/btf/records">
<option value="">Select Year</option>
<option value="20196a5aChampionsOnly.htm">2019 6A-5A</option>
<option value="20194a3aChampionsOnly.htm">2019 4A-3A</option>
<option value="20192a1aChampionsOnly.htm">2019 2A-1A</option>
<option value="2018ChampionsOnly.htm">2018</option>
<option value="2017ChampionsOnly.htm">2017</option>
<option value="2016ChampionsOnly.htm">2016</option>
<option value="2015ChampionsOnly.htm">2015</option>
<option value="2014ChampionsOnly.htm">2014</option>
<option value="20136a5a4aChampionsOnly.htm">2013 6A-5A-4A</option>
<option value="20133a2a1aChampionsOnly.htm">2013 3A-2A-1A</option>
<option value="20126a5a4aChampionsOnly.htm">2012 6A-5A-4A</option>
<option value="20123a2a1aChampionsOnly.htm">2012 3A-2A-1A</option>
</select>' |>
str_extract_all("20[0-9][0-9][1-6a]*ChampionsOnly.htm")
names <- str_split(names[[1]], " ")
names_pdf <- list("boysTrackChampionsThrough2011",
"girlsTrackChampionsThrough2011",
"btrackchampsthrough06",
"gtrackchampsthrough06")
html <- lapply(names, function(l){
read_html(paste("https://www.osaa.org/docs/btf/records/", l, sep=""))
})
l <- html[[6]]
dfs <- list()
cleandata1 <- lapply(html, function(l){
dfs[[length(dfs)+1]]<- data.frame(txt = html_text(l)) |>
separate_rows(txt, sep="\n") |>
mutate(header = str_extract(txt, "(Girls|Boys) [A-Za-z0-9 ]+ [0-9]A"),
Year = str_extract(txt, "[12][0-9][0-9][0-9] OSAA"),
Year = str_extract(Year, "[12][0-9][0-9][0-9]")) |>
fill(header, Year) |>
separate_wider_regex(header, c(" *",
Gender = "(?:Girls|Boys)",
" *",
Event = "[A-Za-z0-9 ]+",
" *",
Class = "[0-9]A",
" *")) |>
filter(str_detect(txt, "1 [^0-9]+ +[0-9]* [^0-9]") ,
!str_detect(txt, "[0-9]\\) [^0-9]")) |>
separate_wider_regex(txt, c(" *",
Rank = "1",
" *",
Name = "[^0-9]+",
" *",
Grade = "[0-9]*",
" *",
School = "[^0-9]+",
" *",
Prelim = "(?:[0-9]+[\\.\\-:]+[0-9\\.\\-:]+)?",
" +",
Mark = "[0-9]+[\\.\\-:]+[0-9][0-9\\.\\-:]+",
" *",
Mark.Note = "(?:[\\+\\-]?[0-9]\\.[0-9])?",
".*"), too_few="debug")
})  |>
bind_rows()  |>
mutate(Event = trimws(str_replace(Event, " Meter (Run|Dash)", "m")),
State = "Oregon",
Year = as.numeric(Year)) |>
filter(Event %in% c("100m", "800m", "1500m", "High Jump", "Pole Vault"))|>
select(State, Year, Gender, Event, Class, Mark, Mark.Note)
#c<- dfs[[1]]
#cleandata |>
#  filter(Year == 2016, Event == "High Jump", Gender=="Boys")
#cleandata |>
#  count(Year, Event, Gender) |>
#  print(n=500)
## PDFS
url <- "boysTrackChampionsThrough2011.pdf"
rawdata <- lapply(names_pdf, function(l){
read.csv(paste("tabula-",l,".csv", sep=""), header=F)
})|>
bind_rows(.id="Gender")
cleandata2 <- rawdata |>
mutate(Text = paste(V1,V2,V3),
Text = gsub(" NA", "", Text)) |>
select(Text, Gender) |>
mutate(Gender = ifelse(as.numeric(Gender) %% 2 == 0, "Girls", "Boys"),
Year = str_extract(Text, "^[12][90][0-9][0-9]"),
Text = str_to_title(Text),
Event = str_extract(Text, "([0-9x]+0(m|-Meter|-Yard) (Dash|(Medley )?Relay|Run|R|[A-Za-z]+ Hurdles|H)|(One|Two) Mile Run|(Long|High|Triple) Jump|Pole Vault|Shot Put|Javelin|Discus)")) |>
fill(Year, Event) |>
filter(!str_detect(Text, "^ *[1-6]a *$")) |>
filter(!str_detect(Text, paste(Event, "*[1-6]a *$" ))) |>
filter(!str_detect(Text, "^ *\\(.*\\) *$")) |>
filter(str_detect(Text, "[0-9A-Za-z ]*[A-Za-z, \\-\\'’\\./]+ ?\\.*[0-9\\.:\\'/ \\-⁄]+[hwa]?")) |>
separate_wider_regex(Text, c("[0-9A-Za-z \\(\\)]*",
Name = "[A-Za-z, \\-\\'’\\./\\(\\)]+",
" ?\\.*",
Mark = "[0-9\\.:\\'/ \\-⁄]+",
Mark.Note="[hwa]?"
), too_few = "align_start") |>
mutate(Mark = ifelse(trimws(Mark) == "", NA, Mark)) |>
drop_na(Mark) |>
filter(Mark != ".") |>
mutate(Year = as.numeric(Year),
Event = str_replace(Event, "-Meter (Dash|Run)", "m"),
Event = str_replace(Event, "-Yard (Dash|Run)", "y"),
Event = str_replace(Event, " (Dash|Run)", ""),
Event = str_replace(Event, "One Mile", "Mile")) |>
filter(Event %in% c("100y", "100m", "880y", "800m", "Mile", "1500m",
"High Jump", "Pole Vault")) |>
mutate(State = "Oregon") |>
select(State, Year, Gender, Event, Mark, Mark.Note)
cleandata <-
bind_rows(list(cleandata1, cleandata2))
write.csv(cleandata, "oregon_clean.csv", row.names = F)
cleandata |>
filter(Year >= 1978) |>
count(Gender, Event, Year) |>
print(n=200)
names_pdf[[4]]
extract_tables(names_pdf[[4]])
View(cleandata)
cleandata2 <- rawdata |>
mutate(Text = paste(V1,V2,V3),
Text = gsub(" NA", "", Text)) |>
select(Text, Gender) |>
mutate(Gender = ifelse(as.numeric(Gender) %% 2 == 0, "Girls", "Boys"),
Year = str_extract(Text, "^[12][90][0-9][0-9]"),
Text = str_to_title(Text),
Event = str_extract(Text, "([0-9x]+0(m|-Meter|-Yard) (Dash|(Medley )?Relay|Run|R|[A-Za-z]+ Hurdles|H)|(One|Two) Mile Run|(Long|High|Triple) Jump|Pole Vault|Shot Put|Javelin|Discus)")) |>
fill(Year, Event) |>
filter(!str_detect(Text, "^ *[1-6]a *$")) |>
filter(!str_detect(Text, paste(Event, "*[1-6]a *$" ))) |>
filter(!str_detect(Text, "^ *\\(.*\\) *$")) |>
filter(str_detect(Text, "[0-9A-Za-z ]*[A-Za-z, \\-\\'’\\./]+ ?\\.*[0-9\\.:\\'/ \\-⁄]+[hwa]?")) |>
separate_wider_regex(Text, c("[0-9A-Za-z \\(\\)]*",
Name = "[A-Za-z, \\-\\'’\\./\\(\\)]+",
" ?\\.*",
Mark = "[0-9\\.:\\'/ \\-⁄]+",
Mark.Note="[hwa]?"
), too_few = "align_start") |>
mutate(Mark = ifelse(trimws(Mark) == "", NA, Mark)) |>
drop_na(Mark) |>
filter(Mark != ".") |>
mutate(Year = as.numeric(Year),
Event = str_replace(Event, "-Meter (Dash|Run)", "m"),
Event = str_replace(Event, "-Yard (Dash|Run)", "y"),
Event = str_replace(Event, " (Dash|Run)", ""),
Event = str_replace(Event, "One Mile", "Mile")) |>
filter(!(Event=="1500m", Mark=="3:08.99")) %>%
cleandata2 <- rawdata |>
mutate(Text = paste(V1,V2,V3),
Text = gsub(" NA", "", Text)) |>
select(Text, Gender) |>
mutate(Gender = ifelse(as.numeric(Gender) %% 2 == 0, "Girls", "Boys"),
Year = str_extract(Text, "^[12][90][0-9][0-9]"),
Text = str_to_title(Text),
Event = str_extract(Text, "([0-9x]+0(m|-Meter|-Yard) (Dash|(Medley )?Relay|Run|R|[A-Za-z]+ Hurdles|H)|(One|Two) Mile Run|(Long|High|Triple) Jump|Pole Vault|Shot Put|Javelin|Discus)")) |>
fill(Year, Event) |>
filter(!str_detect(Text, "^ *[1-6]a *$")) |>
filter(!str_detect(Text, paste(Event, "*[1-6]a *$" ))) |>
filter(!str_detect(Text, "^ *\\(.*\\) *$")) |>
filter(str_detect(Text, "[0-9A-Za-z ]*[A-Za-z, \\-\\'’\\./]+ ?\\.*[0-9\\.:\\'/ \\-⁄]+[hwa]?")) |>
separate_wider_regex(Text, c("[0-9A-Za-z \\(\\)]*",
Name = "[A-Za-z, \\-\\'’\\./\\(\\)]+",
" ?\\.*",
Mark = "[0-9\\.:\\'/ \\-⁄]+",
Mark.Note="[hwa]?"
), too_few = "align_start") |>
mutate(Mark = ifelse(trimws(Mark) == "", NA, Mark)) |>
drop_na(Mark) |>
filter(Mark != ".") |>
mutate(Year = as.numeric(Year),
Event = str_replace(Event, "-Meter (Dash|Run)", "m"),
Event = str_replace(Event, "-Yard (Dash|Run)", "y"),
Event = str_replace(Event, " (Dash|Run)", ""),
Event = str_replace(Event, "One Mile", "Mile")) |>
filter(!(Event=="1500m"& Mark=="3:08.99")) %>%
filter(Event %in% c("100y", "100m", "880y", "800m", "Mile", "1500m",
"High Jump", "Pole Vault")) |>
mutate(State = "Oregon") |>
select(State, Year, Gender, Event, Mark, Mark.Note)
cleandata <-
bind_rows(list(cleandata1, cleandata2))
write.csv(cleandata, "oregon_clean.csv", row.names = F)
library(tidyverse)
setwd("C:\\Users\\reb\\OneDrive\ -\ Colostate\\Thesis\\Historical\ Performance\ Data\\")
#"PerformanceData.csv",
convert_time <- Vectorize(function(time){
t<-str_split(time, ":")
min <- as.numeric(t[[1]][1])
sec <- as.numeric(t[[1]][2])
(min*60)+sec
})
convert_time("2:20.95")
convert_dist <- Vectorize(function(dist){
dist <- trimws(dist)
if(str_detect(dist, "m$")){
dist = gsub("m","", dist)
as.numeric(dist)
} else {
dist = gsub(" \\(tie\\)", "", dist)
dist = gsub(" ", "", dist)
d<- str_split(dist, "[\'’\"”\\-]")[[1]]
d[2] = gsub("1[/⁄?]4", ".25", d[2])
d[2] = gsub("1[/⁄?]2", ".5", d[2])
d[2] =gsub("3[/⁄?]4", ".75", d[2])
inches <- (as.numeric(d[1])*12) + as.numeric(d[2])
inches * 0.0254
}
})
convert_dist("5-7 1⁄4")
performance <- lapply(c("Florida\\florida_clean.csv",
"Georgia\\georgia_clean.csv",
"Illinois\\illinois_clean.csv",
"Kansas\\kansas_clean.csv",
"Maryland\\maryland_clean.csv",
"Massachusetts\\massachusetts_clean.csv",
"Michigan\\michigan_clean.csv",
"Nebraska\\nebraska_clean.csv",
"New York\\new_york_clean.csv",
"North\ Carolina\\north_carolina_clean.csv",
"Ohio\\ohio_clean.csv",
"Oklahoma\\oklahoma_clean.csv",
"Oregon\\oregon_clean.csv",
"Rhode\ Island\\rhode_island_clean.csv",
"Tennessee\\tennessee_clean.csv",
"Washington\\washington_clean.csv",
"Wisconsin\\wisconsin_clean.csv",
"Wyoming\\wyoming_clean.csv"),
read.csv, colClasses=c("Mark.Note"="character")) |>
bind_rows()|>
select(State, Year, Event, Gender, Class, Mark, Mark.Note) |>
filter(Year >= 1978, Year <= 2019) |>
filter((is.na(Class) | Class != "W"), Mark != "") |>
mutate(Mark.raw = Mark,
Mark = case_when(
Event == "100m" ~ as.numeric(gsub(":","",Mark.raw)),
Event == "100y" ~ as.numeric(gsub(":","",Mark.raw)) * 1.094, #check this
Event == "800m" ~ convert_time(gsub(";",":", Mark.raw)),
Event == "880y" ~ convert_time(gsub(";",":", Mark.raw)) * 0.9942,
Event == "1600m" ~ convert_time(gsub(";",":", Mark.raw)),
Event == "1500m" ~ convert_time(gsub(";",":", Mark.raw)) * 1.0737,
Event == "Mile" ~ convert_time(gsub(";",":", Mark.raw)) * 0.9942,
Event == "High Jump" ~ convert_dist(Mark.raw),
Event == "Pole Vault" ~ convert_dist(Mark.raw),
TRUE ~ NA
),
Event.raw = Event,
Event = case_when(
Event.raw == "100y" ~ "100m",
Event.raw == "880y" ~ "800m",
Event.raw == "1500m" ~ "1600m",
Event.raw == "Mile" ~ "1600m",
TRUE ~ Event.raw
))
performance_one <- performance |>
group_by(State, Year, Gender, Event) |>
summarize(Mark = min(Mark)) |>
ungroup() #|>
#pivot_wider( names_from=c(Gender), values_from=Mark)
write.csv(performance, "performance_clean.csv", row.names = F)
write.csv(performance_one, "performance_one_clean.csv", row.names = F)
performance |>
count(State)
performance |>
filter(State=="Massachusetts",
Year < 1982,
Event == "100y / 100m") |>
summarize(mean = mean(Mark))
performance_one |>
ungroup() |>
count(State, Event, Gender) |>
print(n=500)
library(tidyverse)
library(huxtable)
library(plm)
setwd("C:\\Users\\reb\\OneDrive\ -\ Colostate\\Thesis\\Participation\ Data\\")
participation <- read.csv("participation_clean.csv")
nces <- read.csv("nces_clean.csv")
census <- read.csv("census_2020_clean.csv")
setwd("..\\Historical\ Performance\ Data\\")
performance <- read.csv("performance_clean.csv") |>
select(Year, State, Gender, Event, Mark, Mark.Note)
performance_one <- read.csv("performance_one_clean.csv")
data.all <- participation |>
right_join(performance, by=c("State","Year","Gender")) %>%
left_join(nces, by=c("State", "Year")) %>%
left_join(census, by=c("State", "Gender"), relationship = "many-to-many")
data <- participation |>
right_join(performance_one, by=c("State","Year","Gender")) |>
left_join(nces, by=c("State", "Year")) %>%
left_join(census, by=c("State", "Gender"), relationship = "many-to-many") %>%
pivot_wider(names_from = Gender, names_sep=".", values_from = c(Schools, Participation, Mark, Count))
m1 <- data %>%
filter(Event=="100m") %>%
plm(Mark.Girls ~ Participation.Girls, data=., model="within")
huxreg(m1)
m1 <- data %>%
filter(Event=="High Jump") %>%
plm(Mark.Boys ~ Participation.Boys, data=., model="random")
huxreg(m1)
data.analysis <- data %>%
mutate(Participation.Pct.Diff = (Participation.Boys - Participation.Girls)/Participation.Boys *100,
Mark.Pct.Diff = (Mark.Boys - Mark.Girls)/Mark.Boys *100,
Prop.Boys = Count.Boys/(Count.Boys+Count.Girls),
Prop.Girls = Count.Girls/(Count.Boys+Count.Girls))
m1 <- data.analysis %>%
filter(Event=="100m") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m2 <- data.analysis %>%
filter(Event=="800m") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m3<-data.analysis %>%
filter(Event=="1600m") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m4<-data.analysis %>%
filter(Event=="High Jump") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
m5<-data.analysis %>%
filter(Event=="Pole Vault") %>%
plm(Mark.Pct.Diff ~ Participation.Pct.Diff, data=., model="random")
huxreg(m1,m2,m3,m4,m5)
data |>
select(Year,State,Event) |>
distinct() |>
count(State,Event) %>%
print(n=100)
View(data.analysis)
View(cleandata2)
library(tidyverse)
library(tidyverse)
setwd("C:\\Users\\reb\\OneDrive\ -\ Colostate\\Thesis\\Participation\ Data\\")
# imports all demographic state files from folder, tidies
# into combined file of 2020 populations of 15-19 year-olds by state.
data<-lapply(list.files(pattern="DECENNIALDP.*"), read.csv) %>%
rbind(colnames(.),.) %>%
bind_rows(.id="df") %>%
mutate(Gender = str_extract(Label..Grouping., "(Total population|Male|Female)")) %>%
fill(Gender) %>%
filter(str_detect(Label..Grouping.,  "15 to 19 years")) %>%
#select(df, Gender, everything()) %>%
pivot_longer(cols=ends_with("Count"),
names_to="State",
names_pattern=("(^[A-Za-z \\.]+)\\.\\."),
values_to="Count") %>%
mutate(State = gsub("\\.", " ", State),
Gender = case_when(
Gender == "Male" ~ "Boys",
Gender == "Female" ~ "Girls",
TRUE ~ Gender
),
Count = as.numeric(gsub(",","",Count))) %>%
select(df, Gender, State, Count) %>%
drop_na(Count)
# export CSV file
write.csv(data, "census_2020_clean.csv", row.names=F)
# testing
list.files(pattern="DECENNIALDP.*")
